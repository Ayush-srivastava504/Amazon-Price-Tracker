# Amazon Price Tracker - India Configuration
# Updated: 2026-02-08
# Configured for Amazon.in

environment: "development"  # development, staging, production

scraper:
  base_url: "https://www.amazon.in"
  timeout: 15  # Increased timeout for slower responses
  max_retries: 5  # Increased retry attempts
  request_delay: 3  # Increased delay to avoid rate limiting
  max_requests_per_minute: 20  # Rate limiting
  max_html_size_mb: 5
  follow_redirects: true
  verify_ssl: true
  
  # Advanced retry settings
  retry_backoff_factor: 1.5
  retry_status_codes: [429, 500, 502, 503, 504]
  
  # Bot detection evasion
  enable_proxy_rotation: false
  proxy_list: []  # Add proxies if needed
  randomize_delay: true
  min_delay: 2
  max_delay: 5

headers:
  rotation_strategy: "sequential"  # sequential, random
  rotate_every: 15  # requests
  
  # Browser profiles with Indian locale
  user_agents:
    - "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    - "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0"
    - "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    - "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:120.0) Gecko/20100101 Firefox/120.0"
    - "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  
  # Additional headers for better acceptance (India-specific)
  additional_headers:
    Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8"
    Accept-Language: "en-IN,en-GB;q=0.9,en;q=0.8,hi;q=0.7"
    Accept-Encoding: "gzip, deflate, br"
    Sec-Ch-Ua: '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"'
    Sec-Ch-Ua-Mobile: "?0"
    Sec-Ch-Ua-Platform: '"Windows"'

parsing:
  # Price extraction strategies (ordered by priority)
  price_selectors:
    - "span.a-price-whole"
    - "span.a-offscreen"
    - "input#twister-plus-price-data-price"
    - "span#priceblock_ourprice"
    - "span#priceblock_dealprice"
    - "span.a-color-price"
  
  # Selectors for different page types
  title_selector: "span#productTitle"
  availability_selector: "div#availability"
  rating_selector: "span.a-icon-alt"
  seller_selector: "a#sellerProfileTriggerId"
  brand_selector: "a#bylineInfo"
  
  # Parsing fallback strategy
  enable_json_ld_parsing: true
  enable_regex_fallback: true
  
  # Content validation
  min_title_length: 10
  max_title_length: 500

validation:
  # Price validation rules (in INR)
  min_price: 1.0
  max_price: 10000000  # 1 crore INR
  price_change_threshold: 0.5  # 50% change triggers alert
  
  # Required fields
  required_fields:
    - product_id
    - title
    - price
    - timestamp
    - currency
  
  # Field-specific validation
  product_id:
    pattern: "^[A-Z0-9]{10}$"
    required: true
    
  title:
    min_length: 5
    max_length: 500
    required: true
    
  price:
    min_value: 1.0
    max_value: 10000000
    allow_null: false
    
  currency:
    allowed_values: ["INR", "USD", "EUR", "GBP"]
    default: "INR"

monitoring:
  # Performance monitoring
  enable_metrics: true
  metrics_port: 9090
  scrape_timeout_seconds: 30
  success_rate_threshold: 0.8  # Alert if success rate drops below 80%
  
  # Error tracking
  max_consecutive_errors: 5
  error_cooldown_minutes: 10
  
  # Health checks
  health_check_interval: 300  # seconds
  enable_health_endpoint: true
  
  # Alerting thresholds
  alerting:
    price_change_percentage: 20
    out_of_stock_duration_hours: 24
    scrape_failure_rate: 0.3

storage:
  # File storage
  raw_html:
    enabled: true
    directory: "./data/raw_html"
    retention_days: 7
    
  # Database settings
  database:
    type: "sqlite"  # sqlite, postgres, mysql
    connection_string: "sqlite:///data/price_tracker.db"
    batch_size: 100

products:
  # VERIFIED Amazon India ASINs (These are long-standing, popular products)
  sample_asins:
    # Popular Electronics on Amazon.in (verified working)
    - "B0D54JD5BR"  # Fire TV Stick 4K
    - "B0BDJ7CDZ6"  # Echo Dot (5th Gen with Clock)
    - "B0CNY74Q3B"  # boAt Airdopes
    - "B09N3ZNHTY"  # Mi Power Bank 3i
    
    # Books (ISBN format - widely available)
    - "8172234996"  # The Alchemist
    - "8129116758"  # Rich Dad Poor Dad
    - "1846144981"  # The Secret
    
    # Home & Kitchen (established brands)
    - "B07HGT6W6D"  # Prestige Pressure Cooker
    - "B08X2ZH4FW"  # Milton Water Bottle
    - "B01MG86QP4"  # Pigeon Electric Kettle
    
    # Personal Care (trusted brands)
    - "B00MWTKIK6"  # Gillette Mach 3 Blades
    - "B08LQZB3TG"  # Mamaearth Hair Oil

  # Product categories for organization
  categories:
    electronics:
      - "B0D54JD5BR"
      - "B0BDJ7CDZ6"
      - "B0CNY74Q3B"
      - "B09N3ZNHTY"
    
    books:
      - "8172234996"
      - "8129116758"
      - "1846144981"
    
    home_kitchen:
      - "B07HGT6W6D"
      - "B08X2ZH4FW"
      - "B01MG86QP4"
    
    personal_care:
      - "B00MWTKIK6"
      - "B08LQZB3TG"

batch_processing:
  # Batch settings
  batch_size: 10
  max_concurrent_requests: 2
  batch_delay_seconds: 10
  
  # Scheduling (adjusted for Indian timezone - IST)
  schedule:
    enabled: true
    interval_minutes: 60
    times_of_day: ["09:00", "12:00", "15:00", "18:00", "21:00"]  # IST
    
  # Recovery settings
  retry_failed_batches: true
  max_batch_retries: 3

logging:
  # Logging configuration
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "json"  # json, text
  file:
    enabled: true
    path: "./logs/price_tracker.log"
    max_size_mb: 100
    backup_count: 5
  
  # Structured logging
  structured_logging: true
  include_timestamp: true
  include_module: true

advanced:
  # Experimental features
  enable_selenium_fallback: false
  selenium_driver_path: "./drivers/chromedriver"
  
  # Caching
  enable_caching: true
  cache_ttl_seconds: 3600
  
  # Data enrichment
  enable_product_images: false
  enable_reviews_scraping: false
  
  # Privacy
  anonymize_data: false
  data_retention_days: 30

# Environment-specific overrides
development:
  scraper:
    request_delay: 5
    max_retries: 3
  logging:
    level: "DEBUG"

staging:
  scraper:
    request_delay: 3
    max_retries: 5
  monitoring:
    enable_metrics: true

production:
  scraper:
    request_delay: 2
    max_retries: 7
  monitoring:
    enable_metrics: true
    alerting:
      scrape_failure_rate: 0.1